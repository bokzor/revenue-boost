"use strict";(()=>{var Qe=Object.defineProperty;var Xe=(t,e,i)=>e in t?Qe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var u=(t,e,i)=>Xe(t,typeof e!="symbol"?e+"":e,i);var j,m,ke,Ze,P,we,Se,Ie,Ee,ae,oe,re,et,N={},Pe=[],tt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,z=Array.isArray;function k(t,e){for(var i in e)t[i]=e[i];return t}function le(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function R(t,e,i){var n,o,r,l={};for(r in e)r=="key"?n=e[r]:r=="ref"?o=e[r]:l[r]=e[r];if(arguments.length>2&&(l.children=arguments.length>3?j.call(arguments,2):i),typeof t=="function"&&t.defaultProps!=null)for(r in t.defaultProps)l[r]===void 0&&(l[r]=t.defaultProps[r]);return G(t,l,n,o,null)}function G(t,e,i,n,o){var r={type:t,props:e,key:i,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:o??++ke,__i:-1,__u:0};return o==null&&m.vnode!=null&&m.vnode(r),r}function H(t){return t.children}function x(t,e){this.props=t,this.context=e}function A(t,e){if(e==null)return t.__?A(t.__,t.__i+1):null;for(var i;e<t.__k.length;e++)if((i=t.__k[e])!=null&&i.__e!=null)return i.__e;return typeof t.type=="function"?A(t):null}function Re(t){var e,i;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((i=t.__k[e])!=null&&i.__e!=null){t.__e=t.__c.base=i.__e;break}return Re(t)}}function be(t){(!t.__d&&(t.__d=!0)&&P.push(t)&&!q.__r++||we!=m.debounceRendering)&&((we=m.debounceRendering)||Se)(q)}function q(){for(var t,e,i,n,o,r,l,a=1;P.length;)P.length>a&&P.sort(Ie),t=P.shift(),a=P.length,t.__d&&(i=void 0,n=void 0,o=(n=(e=t).__v).__e,r=[],l=[],e.__P&&((i=k({},n)).__v=n.__v+1,m.vnode&&m.vnode(i),ce(e.__P,i,n,e.__n,e.__P.namespaceURI,32&n.__u?[o]:null,r,o??A(n),!!(32&n.__u),l),i.__v=n.__v,i.__.__k[i.__i]=i,Ae(r,i,l),n.__e=n.__=null,i.__e!=o&&Re(i)));q.__r=0}function De(t,e,i,n,o,r,l,a,p,c,d){var s,h,_,w,C,b,g,f=n&&n.__k||Pe,S=e.length;for(p=it(i,e,f,p,S),s=0;s<S;s++)(_=i.__k[s])!=null&&(h=_.__i==-1?N:f[_.__i]||N,_.__i=s,b=ce(t,_,h,o,r,l,a,p,c,d),w=_.__e,_.ref&&h.ref!=_.ref&&(h.ref&&ue(h.ref,null,_),d.push(_.ref,_.__c||w,_)),C==null&&w!=null&&(C=w),(g=!!(4&_.__u))||h.__k===_.__k?p=xe(_,p,t,g):typeof _.type=="function"&&b!==void 0?p=b:w&&(p=w.nextSibling),_.__u&=-7);return i.__e=C,p}function it(t,e,i,n,o){var r,l,a,p,c,d=i.length,s=d,h=0;for(t.__k=new Array(o),r=0;r<o;r++)(l=e[r])!=null&&typeof l!="boolean"&&typeof l!="function"?(p=r+h,(l=t.__k[r]=typeof l=="string"||typeof l=="number"||typeof l=="bigint"||l.constructor==String?G(null,l,null,null,null):z(l)?G(H,{children:l},null,null,null):l.constructor==null&&l.__b>0?G(l.type,l.props,l.key,l.ref?l.ref:null,l.__v):l).__=t,l.__b=t.__b+1,a=null,(c=l.__i=nt(l,i,p,s))!=-1&&(s--,(a=i[c])&&(a.__u|=2)),a==null||a.__v==null?(c==-1&&(o>d?h--:o<d&&h++),typeof l.type!="function"&&(l.__u|=4)):c!=p&&(c==p-1?h--:c==p+1?h++:(c>p?h--:h++,l.__u|=4))):t.__k[r]=null;if(s)for(r=0;r<d;r++)(a=i[r])!=null&&(2&a.__u)==0&&(a.__e==n&&(n=A(a)),Me(a,a));return n}function xe(t,e,i,n){var o,r;if(typeof t.type=="function"){for(o=t.__k,r=0;o&&r<o.length;r++)o[r]&&(o[r].__=t,e=xe(o[r],e,i,n));return e}t.__e!=e&&(n&&(e&&t.type&&!e.parentNode&&(e=A(t)),i.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function nt(t,e,i,n){var o,r,l,a=t.key,p=t.type,c=e[i],d=c!=null&&(2&c.__u)==0;if(c===null&&t.key==null||d&&a==c.key&&p==c.type)return i;if(n>(d?1:0)){for(o=i-1,r=i+1;o>=0||r<e.length;)if((c=e[l=o>=0?o--:r++])!=null&&(2&c.__u)==0&&a==c.key&&p==c.type)return l}return-1}function Ce(t,e,i){e[0]=="-"?t.setProperty(e,i??""):t[e]=i==null?"":typeof i!="number"||tt.test(e)?i:i+"px"}function W(t,e,i,n,o){var r,l;e:if(e=="style")if(typeof i=="string")t.style.cssText=i;else{if(typeof n=="string"&&(t.style.cssText=n=""),n)for(e in n)i&&e in i||Ce(t.style,e,"");if(i)for(e in i)n&&i[e]==n[e]||Ce(t.style,e,i[e])}else if(e[0]=="o"&&e[1]=="n")r=e!=(e=e.replace(Ee,"$1")),l=e.toLowerCase(),e=l in t||e=="onFocusOut"||e=="onFocusIn"?l.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+r]=i,i?n?i.u=n.u:(i.u=ae,t.addEventListener(e,r?re:oe,r)):t.removeEventListener(e,r?re:oe,r);else{if(o=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=i??"";break e}catch{}typeof i=="function"||(i==null||i===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&i==1?"":i))}}function Te(t){return function(e){if(this.l){var i=this.l[e.type+t];if(e.t==null)e.t=ae++;else if(e.t<i.u)return;return i(m.event?m.event(e):e)}}}function ce(t,e,i,n,o,r,l,a,p,c){var d,s,h,_,w,C,b,g,f,S,I,$,B,ye,V,L,ne,T=e.type;if(e.constructor!=null)return null;128&i.__u&&(p=!!(32&i.__u),r=[a=e.__e=i.__e]),(d=m.__b)&&d(e);e:if(typeof T=="function")try{if(g=e.props,f="prototype"in T&&T.prototype.render,S=(d=T.contextType)&&n[d.__c],I=d?S?S.props.value:d.__:n,i.__c?b=(s=e.__c=i.__c).__=s.__E:(f?e.__c=s=new T(g,I):(e.__c=s=new x(g,I),s.constructor=T,s.render=rt),S&&S.sub(s),s.props=g,s.state||(s.state={}),s.context=I,s.__n=n,h=s.__d=!0,s.__h=[],s._sb=[]),f&&s.__s==null&&(s.__s=s.state),f&&T.getDerivedStateFromProps!=null&&(s.__s==s.state&&(s.__s=k({},s.__s)),k(s.__s,T.getDerivedStateFromProps(g,s.__s))),_=s.props,w=s.state,s.__v=e,h)f&&T.getDerivedStateFromProps==null&&s.componentWillMount!=null&&s.componentWillMount(),f&&s.componentDidMount!=null&&s.__h.push(s.componentDidMount);else{if(f&&T.getDerivedStateFromProps==null&&g!==_&&s.componentWillReceiveProps!=null&&s.componentWillReceiveProps(g,I),!s.__e&&s.shouldComponentUpdate!=null&&s.shouldComponentUpdate(g,s.__s,I)===!1||e.__v==i.__v){for(e.__v!=i.__v&&(s.props=g,s.state=s.__s,s.__d=!1),e.__e=i.__e,e.__k=i.__k,e.__k.some(function(D){D&&(D.__=e)}),$=0;$<s._sb.length;$++)s.__h.push(s._sb[$]);s._sb=[],s.__h.length&&l.push(s);break e}s.componentWillUpdate!=null&&s.componentWillUpdate(g,s.__s,I),f&&s.componentDidUpdate!=null&&s.__h.push(function(){s.componentDidUpdate(_,w,C)})}if(s.context=I,s.props=g,s.__P=t,s.__e=!1,B=m.__r,ye=0,f){for(s.state=s.__s,s.__d=!1,B&&B(e),d=s.render(s.props,s.state,s.context),V=0;V<s._sb.length;V++)s.__h.push(s._sb[V]);s._sb=[]}else do s.__d=!1,B&&B(e),d=s.render(s.props,s.state,s.context),s.state=s.__s;while(s.__d&&++ye<25);s.state=s.__s,s.getChildContext!=null&&(n=k(k({},n),s.getChildContext())),f&&!h&&s.getSnapshotBeforeUpdate!=null&&(C=s.getSnapshotBeforeUpdate(_,w)),L=d,d!=null&&d.type===H&&d.key==null&&(L=He(d.props.children)),a=De(t,z(L)?L:[L],e,i,n,o,r,l,a,p,c),s.base=e.__e,e.__u&=-161,s.__h.length&&l.push(s),b&&(s.__E=s.__=null)}catch(D){if(e.__v=null,p||r!=null)if(D.then){for(e.__u|=p?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;r[r.indexOf(a)]=null,e.__e=a}else{for(ne=r.length;ne--;)le(r[ne]);se(e)}else e.__e=i.__e,e.__k=i.__k,D.then||se(e);m.__e(D,e,i)}else r==null&&e.__v==i.__v?(e.__k=i.__k,e.__e=i.__e):a=e.__e=ot(i.__e,e,i,n,o,r,l,p,c);return(d=m.diffed)&&d(e),128&e.__u?void 0:a}function se(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(se)}function Ae(t,e,i){for(var n=0;n<i.length;n++)ue(i[n],i[++n],i[++n]);m.__c&&m.__c(e,t),t.some(function(o){try{t=o.__h,o.__h=[],t.some(function(r){r.call(o)})}catch(r){m.__e(r,o.__v)}})}function He(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:z(t)?t.map(He):k({},t)}function ot(t,e,i,n,o,r,l,a,p){var c,d,s,h,_,w,C,b=i.props,g=e.props,f=e.type;if(f=="svg"?o="http://www.w3.org/2000/svg":f=="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),r!=null){for(c=0;c<r.length;c++)if((_=r[c])&&"setAttribute"in _==!!f&&(f?_.localName==f:_.nodeType==3)){t=_,r[c]=null;break}}if(t==null){if(f==null)return document.createTextNode(g);t=document.createElementNS(o,f,g.is&&g),a&&(m.__m&&m.__m(e,r),a=!1),r=null}if(f==null)b===g||a&&t.data==g||(t.data=g);else{if(r=r&&j.call(t.childNodes),b=i.props||N,!a&&r!=null)for(b={},c=0;c<t.attributes.length;c++)b[(_=t.attributes[c]).name]=_.value;for(c in b)if(_=b[c],c!="children"){if(c=="dangerouslySetInnerHTML")s=_;else if(!(c in g)){if(c=="value"&&"defaultValue"in g||c=="checked"&&"defaultChecked"in g)continue;W(t,c,null,_,o)}}for(c in g)_=g[c],c=="children"?h=_:c=="dangerouslySetInnerHTML"?d=_:c=="value"?w=_:c=="checked"?C=_:a&&typeof _!="function"||b[c]===_||W(t,c,_,b[c],o);if(d)a||s&&(d.__html==s.__html||d.__html==t.innerHTML)||(t.innerHTML=d.__html),e.__k=[];else if(s&&(t.innerHTML=""),De(e.type=="template"?t.content:t,z(h)?h:[h],e,i,n,f=="foreignObject"?"http://www.w3.org/1999/xhtml":o,r,l,r?r[0]:i.__k&&A(i,0),a,p),r!=null)for(c=r.length;c--;)le(r[c]);a||(c="value",f=="progress"&&w==null?t.removeAttribute("value"):w!=null&&(w!==t[c]||f=="progress"&&!w||f=="option"&&w!=b[c])&&W(t,c,w,b[c],o),c="checked",C!=null&&C!=t[c]&&W(t,c,C,b[c],o))}return t}function ue(t,e,i){try{if(typeof t=="function"){var n=typeof t.__u=="function";n&&t.__u(),n&&e==null||(t.__u=t(e))}else t.current=e}catch(o){m.__e(o,i)}}function Me(t,e,i){var n,o;if(m.unmount&&m.unmount(t),(n=t.ref)&&(n.current&&n.current!=t.__e||ue(n,null,e)),(n=t.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(r){m.__e(r,e)}n.base=n.__P=null}if(n=t.__k)for(o=0;o<n.length;o++)n[o]&&Me(n[o],e,i||typeof t.type!="function");i||le(t.__e),t.__c=t.__=t.__e=void 0}function rt(t,e,i){return this.constructor(t,i)}function O(t,e,i){var n,o,r,l;e==document&&(e=document.documentElement),m.__&&m.__(t,e),o=(n=typeof i=="function")?null:i&&i.__k||e.__k,r=[],l=[],ce(e,t=(!n&&i||e).__k=R(H,null,[t]),o||N,N,e.namespaceURI,!n&&i?[i]:o?null:e.firstChild?j.call(e.childNodes):null,r,!n&&i?i:o?o.__e:e.firstChild,n,l),Ae(r,t,l)}j=Pe.slice,m={__e:function(t,e,i,n){for(var o,r,l;e=e.__;)if((o=e.__c)&&!o.__)try{if((r=o.constructor)&&r.getDerivedStateFromError!=null&&(o.setState(r.getDerivedStateFromError(t)),l=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(t,n||{}),l=o.__d),l)return o.__E=o}catch(a){t=a}throw t}},ke=0,Ze=function(t){return t!=null&&t.constructor==null},x.prototype.setState=function(t,e){var i;i=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=k({},this.state),typeof t=="function"&&(t=t(k({},i),this.props)),t&&k(i,t),t!=null&&this.__v&&(e&&this._sb.push(e),be(this))},x.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),be(this))},x.prototype.render=H,P=[],Se=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ie=function(t,e){return t.__v.__b-e.__v.__b},q.__r=0,Ee=/(PointerCapture)$|Capture$/i,ae=0,oe=Te(!1),re=Te(!0),et=0;var F,v,de,Be,U=0,We=[],y=m,Le=y.__b,Ne=y.__r,Oe=y.diffed,Fe=y.__c,Ue=y.unmount,$e=y.__;function pe(t,e){y.__h&&y.__h(v,t,U||e),U=0;var i=v.__H||(v.__H={__:[],__h:[]});return t>=i.__.length&&i.__.push({}),i.__[t]}function M(t){return U=1,at(ze,t)}function at(t,e,i){var n=pe(F++,2);if(n.t=t,!n.__c&&(n.__=[i?i(e):ze(void 0,e),function(a){var p=n.__N?n.__N[0]:n.__[0],c=n.t(p,a);p!==c&&(n.__N=[c,n.__[1]],n.__c.setState({}))}],n.__c=v,!v.__f)){var o=function(a,p,c){if(!n.__c.__H)return!0;var d=n.__c.__H.__.filter(function(h){return!!h.__c});if(d.every(function(h){return!h.__N}))return!r||r.call(this,a,p,c);var s=n.__c.props!==a;return d.forEach(function(h){if(h.__N){var _=h.__[0];h.__=h.__N,h.__N=void 0,_!==h.__[0]&&(s=!0)}}),r&&r.call(this,a,p,c)||s};v.__f=!0;var r=v.shouldComponentUpdate,l=v.componentWillUpdate;v.componentWillUpdate=function(a,p,c){if(this.__e){var d=r;r=void 0,o(a,p,c),r=d}l&&l.call(this,a,p,c)},v.shouldComponentUpdate=o}return n.__N||n.__}function J(t,e){var i=pe(F++,3);!y.__s&&je(i.__H,e)&&(i.__=t,i.u=e,v.__H.__h.push(i))}function Ge(t){return U=5,K(function(){return{current:t}},[])}function K(t,e){var i=pe(F++,7);return je(i.__H,e)&&(i.__=t(),i.__H=e,i.__h=t),i.__}function qe(t,e){return U=8,K(function(){return t},e)}function lt(){for(var t;t=We.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(Y),t.__H.__h.forEach(_e),t.__H.__h=[]}catch(e){t.__H.__h=[],y.__e(e,t.__v)}}y.__b=function(t){v=null,Le&&Le(t)},y.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),$e&&$e(t,e)},y.__r=function(t){Ne&&Ne(t),F=0;var e=(v=t.__c).__H;e&&(de===v?(e.__h=[],v.__h=[],e.__.forEach(function(i){i.__N&&(i.__=i.__N),i.u=i.__N=void 0})):(e.__h.forEach(Y),e.__h.forEach(_e),e.__h=[],F=0)),de=v},y.diffed=function(t){Oe&&Oe(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(We.push(e)!==1&&Be===y.requestAnimationFrame||((Be=y.requestAnimationFrame)||ct)(lt)),e.__H.__.forEach(function(i){i.u&&(i.__H=i.u),i.u=void 0})),de=v=null},y.__c=function(t,e){e.some(function(i){try{i.__h.forEach(Y),i.__h=i.__h.filter(function(n){return!n.__||_e(n)})}catch(n){e.some(function(o){o.__h&&(o.__h=[])}),e=[],y.__e(n,i.__v)}}),Fe&&Fe(t,e)},y.unmount=function(t){Ue&&Ue(t);var e,i=t.__c;i&&i.__H&&(i.__H.__.forEach(function(n){try{Y(n)}catch(o){e=o}}),i.__H=void 0,e&&y.__e(e,i.__v))};var Ve=typeof requestAnimationFrame=="function";function ct(t){var e,i=function(){clearTimeout(n),Ve&&cancelAnimationFrame(e),setTimeout(t)},n=setTimeout(i,35);Ve&&(e=requestAnimationFrame(i))}function Y(t){var e=v,i=t.__c;typeof i=="function"&&(t.__c=void 0,i()),v=e}function _e(t){var e=v;t.__c=t.__(),v=e}function je(t,e){return!t||t.length!==e.length||e.some(function(i,n){return i!==t[n]})}function ze(t,e){return typeof e=="function"?e(t):e}var Q=class{constructor(e){u(this,"config");this.config=e}log(...e){this.config.debug&&console.log("[Revenue Boost API]",...e)}getApiUrl(e){let i=this.config.apiUrl||"",n=e.startsWith("/")?e:`/${e}`;return i?`${i}${n}`:`/apps/revenue-boost${n}`}async fetchActiveCampaigns(e,i){let n=this.buildStorefrontContext(e,i),o=new URLSearchParams({shop:this.config.shopDomain,...n}),r=`${this.getApiUrl("/api/campaigns/active")}?${o.toString()}`;this.log("Fetching campaigns from:",r),this.log("Context:",n);try{let l=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!l.ok)throw new Error(`HTTP ${l.status}: ${l.statusText}`);let a=await l.json();return this.log("Campaigns received:",a),a}catch(l){throw console.error("[Revenue Boost API] Failed to fetch campaigns:",l),l}}buildStorefrontContext(e,i){let n={sessionId:e,pageUrl:window.location.pathname,pageType:this.detectPageType(),deviceType:this.detectDeviceType()};i&&(n.visitorId=i);let o=window;if(typeof o.Shopify<"u"){let r=o.Shopify;r.cart&&(n.cartValue=String(r.cart.total_price/100),n.cartItemCount=String(r.cart.item_count))}return n}detectPageType(){let e=window.location.pathname;return e==="/"||e===""?"home":e.includes("/products/")?"product":e.includes("/collections/")?"collection":e.includes("/cart")?"cart":e.includes("/checkout")?"checkout":"other"}detectDeviceType(){let e=navigator.userAgent.toLowerCase();return/android|webos|iphone|ipod|blackberry|iemobile|opera mini/i.test(e)?"mobile":/ipad|android(?!.*mobile)/i.test(e)?"tablet":"desktop"}async recordFrequency(e,i){let n=this.getApiUrl("/api/analytics/frequency");try{await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e,campaignId:i,timestamp:Date.now()})})}catch(o){console.error("[Revenue Boost API] Failed to record frequency:",o)}}async trackEvent(e){let i=this.getApiUrl("/api/analytics/track");try{await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(n){console.error("[Revenue Boost API] Failed to track event:",n)}}async trackSocialProofEvent(e){let i=this.getApiUrl("/api/social-proof/track");try{await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(n){this.config.debug&&console.error("[Revenue Boost API] Failed to track social proof event:",n)}}};var he="revenue_boost_session",ge="revenue_boost_shown",Ye="revenue_boost_visitor",fe=class{constructor(){u(this,"sessionId");u(this,"visitorId");u(this,"shownCampaigns");this.sessionId=this.initSessionId(),this.visitorId=this.initVisitorId(),this.shownCampaigns=this.loadShownCampaigns(),this.incrementVisitCount()}initSessionId(){let e=sessionStorage.getItem(he);return e||(e=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem(he,e)),e}initVisitorId(){let e=localStorage.getItem(Ye);return e||(e=`visitor_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem(Ye,e)),e}loadShownCampaigns(){let e=sessionStorage.getItem(ge);if(e)try{return new Set(JSON.parse(e))}catch{return new Set}return new Set}saveShownCampaigns(){sessionStorage.setItem(ge,JSON.stringify(Array.from(this.shownCampaigns)))}incrementVisitCount(){let e=parseInt(localStorage.getItem("revenue_boost_visit_count")||"0");localStorage.setItem("revenue_boost_visit_count",(e+1).toString())}getSessionId(){return this.sessionId}getVisitorId(){return this.visitorId}getVisitCount(){return parseInt(localStorage.getItem("revenue_boost_visit_count")||"1")}isReturningVisitor(){return this.getVisitCount()>1}wasShown(e){return this.shownCampaigns.has(e)}markShown(e){this.shownCampaigns.add(e),this.saveShownCampaigns()}getData(){return{sessionId:this.sessionId,visitorId:this.visitorId,visitCount:this.getVisitCount(),isReturningVisitor:this.isReturningVisitor(),shownCampaigns:Array.from(this.shownCampaigns)}}clear(){sessionStorage.removeItem(he),sessionStorage.removeItem(ge),this.shownCampaigns.clear(),this.sessionId=this.initSessionId()}},E=new fe;var X=class{constructor(e={}){u(this,"cache",new Map);u(this,"cfg");u(this,"loadingPromises",new Map);this.cfg={timeoutMs:8e3,debug:!1,...e}}log(...e){this.cfg.debug&&console.log("[Revenue Boost Loader]",...e)}async preloadComponents(e){let i=Array.from(new Set(e));await Promise.all(i.map(n=>this.loadComponent(n).catch(o=>{this.log("Preload failed for",n,o?.message||o)})))}async loadComponent(e){let i=e;if(this.cache.has(i))return this.log("Cache hit:",i),this.cache.get(i);if(this.loadingPromises.has(i))return this.log("Already loading:",i),this.loadingPromises.get(i);let n=this._loadComponentInternal(i);this.loadingPromises.set(i,n);try{let o=await n;return this.cache.set(i,o),o}finally{this.loadingPromises.delete(i)}}async _loadComponentInternal(e){let i=this.loadFromGlobal(e);if(i)return this.cache.set(e,i),i;try{let n=await this.loadViaDynamicImport(e);if(n)return this.cache.set(e,n),n}catch(n){this.log("Dynamic import failed for",e,n)}if(this.cfg.baseUrl)try{let n=await this.loadViaScript(e);if(n)return this.cache.set(e,n),n}catch(n){this.log("Script loading failed for",e,n)}throw new Error(`Component for template '${e}' not found`)}loadFromGlobal(e){let n=globalThis.RevenueBoostComponents;return n&&n[e]?(this.log("Loaded from global registry:",e),n[e]):null}async loadViaDynamicImport(e){return null}async loadViaScript(e){let i=this.getBundleName(e),n=`${this.cfg.baseUrl}/${i}?v=${this.cfg.version||"1"}`;return this.log("Loading script:",n),new Promise((o,r)=>{let l=setTimeout(()=>{r(new Error(`Timeout loading ${i}`))},this.cfg.timeoutMs),a=document.createElement("script");a.src=n,a.async=!0,a.onload=()=>{clearTimeout(l);let p=this.loadFromGlobal(e);p?o(p):r(new Error(`Component ${e} not registered after script load`))},a.onerror=()=>{clearTimeout(l),r(new Error(`Failed to load script: ${n}`))},document.head.appendChild(a)})}getBundleName(e){return`${e.toLowerCase().replace(/_/g,"-")}.bundle.js`}};function dt({campaign:t,onClose:e,onShow:i,loader:n}){let[o,r]=M(null),[l,a]=M(!0),[p,c]=M(null);return J(()=>{let d=!0;async function s(){try{console.log("[PopupManager] Loading component for:",t.templateType);let h=await n.loadComponent(t.templateType);d&&(r(()=>h),a(!1),i?.(t.id))}catch(h){console.error("[PopupManager] Failed to load component:",h),d&&(c(h instanceof Error?h.message:"Failed to load popup"),a(!1))}}return s(),()=>{d=!1}},[t.id,t.templateType]),l?R("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:999999}},"Loading..."):p?(console.error("[PopupManager] Error:",p),null):o?R(o,{config:{...t.contentConfig,...t.designConfig,id:t.id},isVisible:!0,onClose:e,campaignId:t.id,renderInline:!1}):null}function Je(t,e,i,n){let o=document.createElement("div");o.id=`revenue-boost-popup-${t.id}`,document.body.appendChild(o),O(R(dt,{campaign:t,onClose:()=>{e(),r()},onShow:n,loader:i}),o);function r(){O(null,o),o.remove()}return r}var Z=class{constructor(e={}){u(this,"config");u(this,"callback",null);u(this,"active",!1);u(this,"triggered",!1);u(this,"startTime",0);u(this,"mouseMoveHandler",null);this.config={sensitivity:e.sensitivity||"medium",delay:e.delay||1e3,mobileEnabled:e.mobileEnabled||!1}}start(e){this.active||this.isMobile()&&!this.config.mobileEnabled||(this.callback=e,this.active=!0,this.triggered=!1,this.startTime=Date.now(),this.mouseMoveHandler=this.handleMouseMove.bind(this),document.addEventListener("mousemove",this.mouseMoveHandler))}stop(){this.active&&(this.active=!1,this.mouseMoveHandler&&(document.removeEventListener("mousemove",this.mouseMoveHandler),this.mouseMoveHandler=null))}isActive(){return this.active}destroy(){this.stop(),this.callback=null}handleMouseMove(e){!this.active||this.triggered||Date.now()-this.startTime<this.config.delay||this.isExitIntent(e)&&this.trigger()}isExitIntent(e){let i=this.getSensitivityThreshold();return e.clientY<=i}getSensitivityThreshold(){switch(this.config.sensitivity){case"low":return 5;case"medium":return 20;case"high":return 50;default:return 20}}trigger(){this.triggered||!this.callback||(this.triggered=!0,this.callback(),this.stop())}isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}};var ee=class{constructor(e={}){u(this,"config");u(this,"callback",null);u(this,"active",!1);u(this,"triggered",!1);u(this,"scrollHandler",null);u(this,"debounceTimer",null);this.config={depthPercentage:e.depthPercentage||50,direction:e.direction||"down",debounceTime:e.debounceTime||100}}start(e){this.active||(this.callback=e,this.active=!0,this.triggered=!1,this.scrollHandler=this.handleScroll.bind(this),window.addEventListener("scroll",this.scrollHandler,{passive:!0}))}stop(){this.active&&(this.active=!1,this.scrollHandler&&(window.removeEventListener("scroll",this.scrollHandler,!1),this.scrollHandler=null),this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null))}isActive(){return this.active}getCurrentScrollDepth(){let e=window.scrollY||window.pageYOffset,i=document.documentElement.scrollHeight,n=window.innerHeight,o=i-n;if(o<=0)return 0;let r=e/o*100;return Math.min(100,Math.max(0,Math.round(r)))}hasReachedDepth(){return this.getCurrentScrollDepth()>=this.config.depthPercentage}destroy(){this.stop(),this.callback=null}handleScroll(e){!this.active||this.triggered||(this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(()=>{this.checkScrollDepth()},this.config.debounceTime))}checkScrollDepth(){!this.active||this.triggered||this.hasReachedDepth()&&this.trigger()}trigger(){this.triggered||!this.callback||(this.triggered=!0,this.callback(),this.stop())}};var te=class{constructor(e={}){u(this,"config");u(this,"callback",null);u(this,"active",!1);u(this,"triggered",!1);u(this,"timer",null);u(this,"lastActivityTime",0);u(this,"activityHandler",null);this.config={idleDuration:e.idleDuration||3e4,events:e.events||["mousemove","mousedown","keypress","scroll","touchstart","click"]}}start(e){this.active||(this.callback=e,this.active=!0,this.triggered=!1,this.lastActivityTime=Date.now(),this.activityHandler=this.handleActivity.bind(this),this.config.events.forEach(i=>{document.addEventListener(i,this.activityHandler,{passive:!0})}),this.resetTimer())}stop(){this.active&&(this.active=!1,this.activityHandler&&(this.config.events.forEach(e=>{document.removeEventListener(e,this.activityHandler,!1)}),this.activityHandler=null),this.timer!==null&&(clearTimeout(this.timer),this.timer=null))}isActive(){return this.active}getIdleTime(){return this.active?Date.now()-this.lastActivityTime:0}destroy(){this.stop(),this.callback=null}handleActivity(e){!this.active||this.triggered||(this.lastActivityTime=Date.now(),this.resetTimer())}resetTimer(){this.timer!==null&&clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.trigger()},this.config.idleDuration)}trigger(){this.triggered||!this.callback||(this.triggered=!0,this.callback(),this.stop())}};var ie=class{constructor(){u(this,"cleanupFunctions",[]);u(this,"exitIntentDetector",null);u(this,"scrollDepthTracker",null);u(this,"timeDelayHandler",null);u(this,"idleTimer",null);u(this,"cartEventListener",null);u(this,"customEventHandler",null)}async evaluateTriggers(e){let i=e.clientTriggers?.enhancedTriggers;if(console.log("[Revenue Boost] \u{1F3AF} Evaluating triggers for campaign:",e.id),!i||Object.keys(i).length===0)return console.log("[Revenue Boost] \u2705 No triggers defined, showing campaign immediately"),!0;let n=i.logic_operator||"AND";console.log("[Revenue Boost] \u{1F517} Trigger logic operator:",n);let o=[],r={};if(i.page_load!==void 0){console.log("[Revenue Boost] \u{1F4C4} Checking page_load trigger:",i.page_load);let a=await this.checkPageLoad(i.page_load);r.page_load=a,o.push(a),console.log(`[Revenue Boost] ${a?"\u2705":"\u274C"} page_load trigger ${a?"passed":"failed"}`)}if(i.scroll_depth!==void 0){console.log("[Revenue Boost] \u{1F4DC} Checking scroll_depth trigger:",i.scroll_depth);let a=await this.checkScrollDepth(i.scroll_depth);r.scroll_depth=a,o.push(a),console.log(`[Revenue Boost] ${a?"\u2705":"\u274C"} scroll_depth trigger ${a?"passed":"failed"}`)}if(i.exit_intent!==void 0){console.log("[Revenue Boost] \u{1F6AA} Checking exit_intent trigger:",i.exit_intent);let a=await this.checkExitIntent(i.exit_intent);r.exit_intent=a,o.push(a),console.log(`[Revenue Boost] ${a?"\u2705":"\u274C"} exit_intent trigger ${a?"passed":"failed"}`)}if(i.idle_timer!==void 0){console.log("[Revenue Boost] \u23F1\uFE0F Checking idle_timer trigger:",i.idle_timer);let a=await this.checkIdleTimer(i.idle_timer);r.idle_timer=a,o.push(a),console.log(`[Revenue Boost] ${a?"\u2705":"\u274C"} idle_timer trigger ${a?"passed":"failed"}`)}if(o.length===0)return console.log("[Revenue Boost] \u26A0\uFE0F No enabled triggers found, showing campaign immediately"),!0;let l;return n==="OR"?(l=o.some(a=>a===!0),console.log("[Revenue Boost] \u{1F500} OR logic: At least one trigger must pass")):(l=o.every(a=>a===!0),console.log("[Revenue Boost] \u{1F517} AND logic: All triggers must pass")),console.log("[Revenue Boost] \u{1F4CA} Trigger evaluation summary:",r),console.log(`[Revenue Boost] ${l?"\u2705 CAMPAIGN WILL SHOW":"\u274C CAMPAIGN WILL NOT SHOW"} - Final result: ${l}`),l}async checkPageLoad(e){if(!e.enabled)return console.log("[Revenue Boost] \u23ED\uFE0F page_load trigger is disabled"),!1;let i=e.delay||0;return console.log(`[Revenue Boost] \u23F3 page_load trigger waiting ${i}ms before showing`),i>0&&await this.delay(i),console.log("[Revenue Boost] \u2705 page_load trigger delay completed"),!0}async checkScrollDepth(e){if(!e.enabled)return console.log("[Revenue Boost] \u23ED\uFE0F scroll_depth trigger is disabled"),!1;let i=e.depth_percentage||50,n=e.direction||"down";return console.log(`[Revenue Boost] \u{1F4CF} scroll_depth trigger waiting for ${i}% scroll ${n}`),new Promise(o=>{this.scrollDepthTracker=new ee({depthPercentage:i,direction:n}),this.scrollDepthTracker.start(()=>{console.log(`[Revenue Boost] \u2705 scroll_depth trigger detected: User scrolled ${i}% ${n}`),o(!0)}),this.scrollDepthTracker.hasReachedDepth()&&(console.log(`[Revenue Boost] \u2705 scroll_depth trigger already met: User already at ${i}% depth`),this.scrollDepthTracker.destroy(),o(!0))})}async checkExitIntent(e){if(!e.enabled)return console.log("[Revenue Boost] \u23ED\uFE0F exit_intent trigger is disabled"),!1;let i=e.sensitivity||"medium",n=e.delay||1e3;return console.log(`[Revenue Boost] \u{1F6AA} exit_intent trigger waiting for exit intent (sensitivity: ${i}, delay: ${n}ms)`),new Promise(o=>{this.exitIntentDetector=new Z({sensitivity:i,delay:n}),this.exitIntentDetector.start(()=>{console.log("[Revenue Boost] \u2705 exit_intent trigger detected: User showed exit intent"),o(!0)})})}async checkIdleTimer(e){if(!e.enabled)return console.log("[Revenue Boost] \u23ED\uFE0F idle_timer trigger is disabled"),!1;let i=e.idle_duration||30;return console.log(`[Revenue Boost] \u23F1\uFE0F idle_timer trigger waiting for ${i}s of inactivity`),new Promise(n=>{this.idleTimer=new te({idleDuration:i*1e3}),this.idleTimer.start(()=>{console.log(`[Revenue Boost] \u2705 idle_timer trigger detected: User was idle for ${i}s`),n(!0)})})}delay(e){return new Promise(i=>{let n=setTimeout(i,e);this.cleanupFunctions.push(()=>clearTimeout(n))})}cleanup(){this.cleanupFunctions.forEach(e=>e()),this.cleanupFunctions=[],this.exitIntentDetector&&(this.exitIntentDetector.destroy(),this.exitIntentDetector=null),this.scrollDepthTracker&&(this.scrollDepthTracker.destroy(),this.scrollDepthTracker=null),this.timeDelayHandler&&(this.timeDelayHandler.destroy(),this.timeDelayHandler=null),this.idleTimer&&(this.idleTimer.destroy(),this.idleTimer=null),this.cartEventListener&&(this.cartEventListener.destroy(),this.cartEventListener=null),this.customEventHandler&&(this.customEventHandler.destroy(),this.customEventHandler=null)}};function _t(t){return t!=null&&typeof t=="object"&&"productId"in t&&(typeof t.productId=="string"||typeof t.productId=="number")}function Ke(t,e){document.addEventListener("cart:updated",n=>{let o=n.detail;if(_t(o)){let r=String(o.productId);me(t,e,r)}});let i=window.fetch;window.fetch=async function(...n){let[o,r]=n;if((typeof o=="string"?o:o.toString()).includes("/cart/add")&&r?.method==="POST")try{let a=await i.apply(this,n),c=await a.clone().json();if(c.id||c.product_id){let d=`gid://shopify/Product/${c.product_id||c.id}`;me(t,e,d)}return a}catch{return i.apply(this,n)}return i.apply(this,n)},document.addEventListener("submit",n=>{let o=n.target;if(o.action&&o.action.includes("/cart/add")){let l=new FormData(o).get("id");if(l){let a=`gid://shopify/Product/${l}`;me(t,e,a)}}}),console.log("[Revenue Boost] \u{1F6D2} Cart tracking initialized")}async function me(t,e,i){try{await t.trackSocialProofEvent({eventType:"add_to_cart",productId:i,shop:e}),console.log("[Revenue Boost] \u{1F6D2} Tracked add-to-cart:",i)}catch(n){console.debug("[Revenue Boost] Failed to track add-to-cart:",n)}}if(typeof window<"u"){let t=window;t.RevenueBoostPreact={h:R,render:O,Component:x,Fragment:H,hooks:{useState:M,useEffect:J,useCallback:qe,useRef:Ge,useMemo:K}},console.log("[Revenue Boost] \u269B\uFE0F Preact runtime exposed globally")}function pt(){let t=window.REVENUE_BOOST_CONFIG||{};return{apiUrl:t.apiUrl||"",shopDomain:t.shopDomain||"",debug:t.debug||!1,previewMode:t.previewMode||!1,previewId:t.previewId,sessionId:t.sessionId,visitCount:t.visitCount,isReturningVisitor:t.isReturningVisitor,deviceType:t.deviceType}}function ht(){return new Promise(t=>{document.readyState==="complete"||document.readyState==="interactive"?t():document.addEventListener("DOMContentLoaded",()=>t())})}var ve=class{constructor(){u(this,"config",pt());u(this,"api",new Q(this.config));u(this,"loader",new X({debug:this.config.debug,baseUrl:this.config.apiUrl?`${this.config.apiUrl}/bundles`:"/apps/revenue-boost/bundles",version:"1"}));u(this,"triggerManager",new ie);u(this,"initialized",!1);u(this,"cleanupFn",null)}log(...e){this.config.debug&&console.log("[Revenue Boost]",...e)}async init(){if(this.initialized){this.log("Already initialized");return}console.log("[Revenue Boost] \u{1F680} Starting initialization..."),console.log("[Revenue Boost] \u{1F4CB} Config:",this.config),console.log("[Revenue Boost] \u{1F511} Session ID:",E.getSessionId()),console.log("[Revenue Boost] \u{1F464} Visitor ID:",E.getVisitorId()),await ht(),this.log("DOM ready"),this.trackPageView(),Ke(this.api,this.config.shopDomain);try{let e=await this.api.fetchActiveCampaigns(E.getSessionId(),E.getVisitorId()),{campaigns:i}=e,n=i;if(this.log(`Campaigns received: ${n?.length||0}`),!n||n.length===0){this.log("No active campaigns");return}this.setupCampaigns(n),this.initialized=!0,console.log("[Revenue Boost] \u2705 Initialization complete!")}catch(e){console.error("[Revenue Boost] \u274C Error fetching campaigns:",e)}}async trackPageView(){try{let e=this.getProductIdFromPage(),i=window.location.pathname;await this.api.trackSocialProofEvent({eventType:e?"product_view":"page_view",productId:e,pageUrl:i,shop:this.config.shopDomain}),this.log("Page view tracked for social proof")}catch(e){this.log("Failed to track page view:",e)}}getProductIdFromPage(){let e=window;if(typeof e.ShopifyAnalytics<"u"){let i=e.ShopifyAnalytics?.meta;if(i?.product?.id)return`gid://shopify/Product/${i.product.id}`}window.location.pathname.includes("/products/")}setupCampaigns(e){let n=e.sort((r,l)=>(l.priority||0)-(r.priority||0)).filter(r=>this.config.previewMode&&this.config.previewId===r.id?!0:E.wasShown(r.id)?(this.log(`Campaign already shown: ${r.id}`),!1):!0);if(n.length===0){this.log("No campaigns to display");return}let o=n[0];this.log("Showing campaign:",o.name),this.config.previewMode&&this.config.previewId===o.id?setTimeout(()=>this.showCampaign(o),0):this.showCampaign(o)}async showCampaign(e){if(this.config.previewMode&&this.config.previewId===e.id){this.renderCampaign(e);return}this.log("Evaluating triggers for campaign:",e.name);try{await this.triggerManager.evaluateTriggers(e)?(this.log("Triggers passed, showing campaign"),this.renderCampaign(e)):this.log("Triggers not met, campaign not shown")}catch(n){console.error("[Revenue Boost] Error evaluating triggers:",n),this.renderCampaign(e)}}async renderCampaign(e){this.config.previewMode&&this.config.previewId===e.id||(E.markShown(e.id),await this.api.recordFrequency(E.getSessionId(),e.id)),this.cleanupFn=Je(e,()=>{this.log("Popup closed"),this.cleanupFn=null,this.triggerManager.cleanup()},this.loader,n=>{this.log("Popup shown:",n)})}},gt=new ve;gt.init().catch(t=>{console.error("[Revenue Boost] Initialization failed:",t)});})();
