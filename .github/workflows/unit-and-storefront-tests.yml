name: Unit and Storefront Tests

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

# Automatically cancel previous runs when new ones start
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # Check if self-hosted runner is available
  check-runner:
    name: ğŸ” Check Runner
    uses: ./.github/workflows/check-runner.yml
    with:
      runner_labels: 'self-hosted'

  # Run all tests using reusable workflow
  tests:
    name: ğŸ§ª Tests
    needs: check-runner
    uses: ./.github/workflows/reusable-tests.yml
    with:
      runner: ${{ needs.check-runner.outputs.runner }}
      run_unit_tests: true
      run_integration_tests: true
      run_lint: true
      run_typecheck: true
      node_version: '24'
